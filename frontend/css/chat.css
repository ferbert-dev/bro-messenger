:root{
  --bg:#f6f7fb;
  --panel:#ffffff;
  --muted:#8b8f9c;
  --text:#1d2330;
  --primary:#4f46e5;
  --accent:#10b981;
  --bubble:#f1f3f9;
  --shadow:0 10px 30px rgba(0,0,0,.06);
  --radius:18px;
  --phi:1.618;
  --left-fr: 1;
  --right-fr: 3;
  --maxw: 1200px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--text);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
}
.topbar{
  width:100%;
  max-width:var(--maxw);
  margin:0 auto;
  padding:18px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:16px;
  background:linear-gradient(135deg,#4f46e5,#6366f1);
  border-radius:0 0 20px 20px;
  box-shadow:0 12px 30px rgba(79,70,229,.25);
  color:#fff;
}
.logo{font-weight:700; font-size:20px; color:inherit}
.topbar-actions{display:flex; align-items:center; gap:12px}
.avatar-btn{width:42px; height:42px; border-radius:50%; border:none; background:rgba(255,255,255,.25); color:#1f2937; font-weight:600; display:grid; place-items:center; cursor:pointer; transition:transform .12s ease, background .2s ease}
.avatar-btn span{font-size:16px; text-transform:uppercase}
.avatar-btn:hover{background:rgba(255,255,255,.4)}
.avatar-btn:active{transform:translateY(1px)}
.topbar .avatar-btn{color:#fff}
.wrap{min-height:100%; display:flex; flex-direction:column; align-items:center; gap:16px}
.container{
  width:100%; max-width:var(--maxw); margin:0 auto; padding:24px;
  display:grid; gap:24px;
  grid-template-columns: minmax(220px, 1fr) minmax(360px, 3fr);
  grid-template-areas: "sidebar chat";
  transition:transform .3s ease;
}
.panel{background:var(--panel); border-radius:20px; box-shadow:var(--shadow)}

/* Sidebar */
.sidebar{grid-area:sidebar; display:flex; flex-direction:column; overflow:hidden; height:70vh; min-height:540px}
.sb-head{padding:18px 18px 10px; border-bottom:1px solid #eef0f5; display:flex; align-items:center; justify-content:space-between; gap:12px}
.title{margin:0; font-weight:700; font-size:18px}
.icon-btn{width:36px; height:36px; border-radius:50%; border:none; background:#eef2ff; color:#4f46e5; font-size:22px; display:grid; place-items:center; cursor:pointer; transition:background .2s ease}
.icon-btn:hover{background:#e0e7ff}
.search{padding:12px 16px}
.search input{
  width:100%; border:1px solid #e6e8f0; border-radius:12px; padding:10px 14px;
  outline:none; font:inherit; background:#fafbff;
}
.chat-list{flex:1; overflow:auto; padding:8px 6px 10px}
.chat-item{display:flex; gap:12px; align-items:center; padding:10px 12px; border-radius:14px; cursor:pointer}
.chat-item:hover{background:#f4f6fb}
.chat-item.active{background:#eef2ff;}
.avatar{width:40px; height:40px; border-radius:50%; background:linear-gradient(135deg,#dbeafe,#e9d5ff); display:grid; place-items:center; font-weight:700; color:#4338ca}
.avatar{overflow:hidden; position:relative}
.avatar.is-online{outline:3px solid rgba(34,197,94,.65); outline-offset:3px; box-shadow:0 6px 16px rgba(34,197,94,.25);}
.avatar img{width:100%; height:100%; object-fit:cover}
.ci-main{flex:1; min-width:0}
.ci-top{display:flex; justify-content:space-between; gap:8px}
.ci-name{font-weight:600}
.ci-time{font-size:12px; color:var(--muted)}
.ci-last{font-size:13px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis}

/* Chat */
.chat{grid-area:chat; display:flex; flex-direction:column; height:70vh; min-height:540px}
.chat-head{display:flex; align-items:center; gap:12px; padding:16px 18px; border-bottom:1px solid #eef0f5}
.online{margin-left:auto; width:10px; height:10px; border-radius:50%; background:#d4d7e5; position:relative; transition:background .2s ease, box-shadow .2s ease}
.online.online--active{background:#22c55e; box-shadow:0 0 0 2px rgba(34,197,94,.22);}
.room{font-weight:700}
.room small{display:block; color:var(--muted); font-weight:500}
.back-btn{display:none; width:40px; height:40px; border-radius:12px; border:none; background:linear-gradient(135deg,#eef2ff,#dbeafe); color:#4338ca; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 6px 18px rgba(79,70,229,.18); transition:transform .12s ease, box-shadow .2s ease; padding:0}
.back-btn svg{pointer-events:none}
.back-btn:hover{box-shadow:0 8px 24px rgba(79,70,229,.24)}
.back-btn:active{transform:translateY(1px); box-shadow:0 4px 12px rgba(79,70,229,.18)}

.chat-body{flex:1; overflow:auto; padding:18px; background:linear-gradient(#fff, #fff) padding-box, repeating-linear-gradient(180deg, #f7f8fc 0, #f7f8fc 40px, #ffffff 40px, #ffffff 80px) border-box; border-radius:0 0 20px 20px}

.divider{display:flex; align-items:center; gap:12px; color:var(--muted); margin:12px 0; font-size:12px; font-weight:600; letter-spacing:.08em; text-transform:uppercase}
.divider::before,.divider::after{content:""; height:1px; background:linear-gradient(90deg, rgba(100,116,139,.15), rgba(100,116,139,0)); flex:1}
.divider::after{background:linear-gradient(90deg, rgba(100,116,139,0), rgba(100,116,139,.15))}

.bubble{position:relative; max-width:70%; padding:8px 12px; border-radius:20px; background:#eceffd; color:#1f2937; box-shadow:none; border:none; display:flex; flex-direction:column; gap:6px}
.bubble::after{content:""; position:absolute; top:6px; width:16px; height:16px; background:inherit; clip-path:path("M16,0 L0,8 L16,16 Z");}
.bubble strong{display:block; font-weight:600; color:#202b4b; margin:0}
.bubble p{margin:0; line-height:1.45}
.bubble .meta{align-self:flex-end; margin:0; font-size:12px; color:#6b7280}
.row{margin:10px 0; display:flex; gap:10px}
.row .avatar-sm{width:36px; height:36px; border-radius:50%; background:linear-gradient(135deg,#dbeafe,#e9d5ff); display:grid; place-items:center; font-weight:600; color:#4338ca; overflow:hidden; flex-shrink:0; position:relative; margin-right:3px}
.row.me .avatar-sm{margin-left:4px; margin-right:0}
.row .avatar-sm img{width:100%; height:100%; object-fit:cover}
.row .avatar-sm.is-online{outline:3px solid rgba(34,197,94,.7); outline-offset:3px; box-shadow:0 4px 12px rgba(34,197,94,.25)}
.row.me{justify-content:flex-end}
.row.me .bubble{background:#d6f6ff}
.row.me .bubble::after{left:auto; right:-10px; transform:scaleX(-1); transform-origin:center}
.row:not(.me) .bubble::after{left:-10px}
.row.me .avatar-sm{order:2}
.row.system{justify-content:center}
.row.system .bubble{background:transparent; border:none; box-shadow:none; color:var(--muted); text-align:center; display:block}
.meta{font-size:12px; color:var(--muted); margin: 0 4px}
.row .bubble .meta{align-self:flex-end; margin:0; color:#6b7280}

.input{display:flex; align-items:center; gap:10px; padding:14px; border-top:1px solid #eef0f5; background:#fff; border-radius:0 0 20px 20px; position:relative}
.emoji-wrapper{position:relative; display:flex; align-items:center}
.emoji-btn{width:38px; height:38px; border-radius:12px; border:1px solid #e5e7eb; background:#f8fafc; font-size:20px; cursor:pointer; display:grid; place-items:center; transition:background .2s ease, transform .1s ease}
.emoji-btn:hover{background:#eef2ff}
.emoji-btn:active{transform:translateY(1px)}
.emoji-popover{position:absolute; bottom:48px; left:0; z-index:1200; background:#fff; border-radius:16px; box-shadow:0 16px 40px rgba(15,23,42,.22); padding:8px; display:none}
.emoji-popover.open{display:block}
.emoji-popover emoji-picker{--emoji-size:24px; width:280px; max-height:320px}
.input input{flex:1; border:1px solid #e6e8f0; border-radius:14px; padding:12px 14px; outline:none; font:inherit}
.btn{border:none; border-radius:10px; padding:10px 18px; font-weight:600; background:var(--primary); color:#fff; cursor:pointer; transition:transform .1s ease, background .2s ease}
.btn:active{transform:translateY(1px)}
.btn:hover{background:#4338ca}
.btn-circle{width:42px; height:42px; border-radius:50%; padding:0; display:grid; place-items:center}
.btn.secondary{background:#e5e7eb; color:#111827}
.btn.secondary:hover{background:#d1d5db}
.topbar .btn.secondary{
  background:rgba(255,255,255,.18);
  color:#fff;
  border:1px solid rgba(255,255,255,.35);
  backdrop-filter:blur(6px);
}
.topbar .btn.secondary:hover{background:rgba(255,255,255,.28)}
.modal{position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; padding:24px; z-index:1000}
.modal.open{display:flex}
.modal-content{background:#fff; border-radius:18px; padding:24px; width:100%; max-width:360px; box-shadow:var(--shadow); display:flex; flex-direction:column; gap:18px}
.modal-content h3{margin:0; font-size:20px}
.modal-content input{width:100%; border:1px solid #d1d5db; border-radius:10px; padding:10px 12px; font:inherit}
.modal-content input[type="file"]{padding:8px 0; border:none}
.modal-actions{display:flex; justify-content:flex-end; gap:12px}
.modal-error{color:#b91c1c; font-size:13px; min-height:16px; margin:0}
.modal-subtext{margin:0; color:var(--muted); font-size:14px}
.avatar-preview{width:72px; height:72px; border-radius:50%; background:linear-gradient(135deg,#dbeafe,#e9d5ff); display:grid; place-items:center; font-weight:700; color:#4338ca; overflow:hidden}
.avatar-preview span{pointer-events:none}
.avatar-preview img{width:100%; height:100%; object-fit:cover}

.avatar-btn.has-image{background:none; background-size:cover; background-position:center; background-repeat:no-repeat; color:transparent}
.avatar-btn.has-image span{display:none}
.sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0}

/* Responsive */
@media (max-width: 980px){
  .container{grid-template-columns: 1fr; grid-template-areas:"sidebar"; padding:16px; gap:16px}
  .container.show-chat{grid-template-areas:"chat"}
  .container.show-chat .sidebar{display:none}
  .container:not(.show-chat) .chat{display:none}
  .container.show-chat .chat{display:flex}
  .sidebar{min-height:auto; height:auto}
  .chat{height:auto; min-height:calc(100vh - 200px)}
  .chat-head{gap:10px; padding:14px 16px}
  .chat-head{justify-content:center; position:relative}
  .chat-head .avatar{margin:0 0}
  .chat-head .room{text-align:center; flex:0 1 auto}
  .chat-head .online{position:absolute; right:12px}
  .back-btn{display:flex; position:absolute; left:12px; top:50%; transform:translateY(-50%); width:40px; height:40px}
  .back-btn svg{margin:0}
  .container:not(.show-chat) .back-btn{display:none}
  .input{padding:12px; gap:8px}
  .emoji-popover{left:0; right:auto}
}
